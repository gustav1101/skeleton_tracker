<?xml version="1.0"?>
<launch>
  <arg name="tfpose_output_topic" value="tfpose_ros/pose" />
  <arg name="camera_name" value="xtion1" />
  <arg name="skeleton_topic" value="skeleton_to_3d/skeleton" />
  <arg name="sensor_namespace" value="sensor1" />
  
  <include file="$(find skeleton3d)/launch/generate_skeleton3d.launch">
    <arg name="pointcloud" value="$(arg camera_name)/depth_registered/points" />
    <arg name="sensor_namespace" value="$(arg sensor_namespace)" />
    <arg name="skeleton_topic" value="$(arg skeleton_topic)" />
    <arg name="camera_name" value="$(arg camera_name)" />
    <arg name="scatter_distance" value="3" />
  </include>
  
  <node name="skeleton_repository" pkg="skeleton3d" type="skeleton_repository" output="screen">
    <param name="position_tolerance" type="double" value="0.6" />
    <param name="skeleton_input" type="str" value="/$(arg sensor_namespace)/$(arg skeleton_topic)" />
    <param name="masterlist_output" type="str" value="/skeleton3d/masterlist" />
    <param name="publish_interval" type="double" value="0.08" />
  </node>

  <node name="skeleton_to_3d_vis" pkg="skeleton3d" type="skeleton_visualiser" output="screen">
    <param name="input_skeleton" type="str" value="/skeleton3d/masterlist" />
    <param name = "output_marker" type="str" value="/skeleton_to_3d_vis/skeleton_vis" />
    <param name="camera_name" type="str" value="$(arg camera_name)" />
  </node>

  <node name="pose_estimator_vis" pkg="tfpose_ros" type="visualization.py" output="screen" ns="$(arg sensor_namespace)" >
    <param name="camera" value="/$(arg sensor_namespace)/$(arg camera_name)/rgb/image_raw" />
    <param name="pose" value="/$(arg sensor_namespace)/pose_estimator/pose" />
  </node>

  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find skeleton3d)/rviz/playbag_markers.rviz" />
</launch>
